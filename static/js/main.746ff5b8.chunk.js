(this["webpackJsonpsnake-evolver"]=this["webpackJsonpsnake-evolver"]||[]).push([[0],{1432:function(e,t){},1447:function(e,t,a){},1451:function(e,t,a){"use strict";a.r(t);var i=a(0),n=a.n(i),s=a(29),r=a.n(s);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(636);var o=a(356),l=a(113),c=a(22),h=a(23),u=a(53),d=a(54),p=a(17),v=a(194);function f(e,t){var a=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16);return"rgba(".concat(a,", ").concat(i,", ").concat(n,", ").concat(t,")")}var m=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(c.a)(this,a),(i=t.call(this,e)).game=void 0,i.unitWidth=void 0,i.unitHeight=void 0,i.canvas=void 0,i.ctx=void 0,i.game=i.props.game,i.game.addCallback("onMove",i.display.bind(Object(v.a)(i))).addCallback("onEnd",i.display.bind(Object(v.a)(i))),i.unitWidth=i.props.width/i.game.props.columns,i.unitHeight=i.props.height/i.game.props.rows,i.canvas=n.a.createRef(),i}return Object(h.a)(a,[{key:"display",value:function(){this.ctx.clearRect(0,0,this.props.width,this.props.height),this.game.props.speed===1/0?this.displayFastForward():this.displayGame()}},{key:"displayFastForward",value:function(){var e=this.ctx;e.save(),e.fillStyle="#333333",e.font="bold 36px sans-serif",e.textAlign="center",e.fillText("Fast Forwarding",this.props.width/2,this.props.height/2),e.font="16px sans-serif",e.fillText("(Snakes are training in the background)",this.props.width/2,this.props.height/2+40),e.restore()}},{key:"displayGame",value:function(){var e=this;this.displayGrid(),this.game.visibleSnakes.forEach((function(t){e.displaySnake(t),e.displayFruit(t)})),this.displayWalls()}},{key:"displayFruit",value:function(e){if(e.fruit){var t=Object(p.a)(e.fruit,2),a=t[0],i=t[1],n=this.ctx;n.save();var s,r,o,l,c,h=this.positionHasOverlap(this.game.board.get([a,i]))?.4:1;n.fillStyle=f(e.color,h),s=n,r=i*this.unitWidth,o=a*this.unitWidth,l=this.unitWidth,c=this.unitHeight,s.beginPath(),s.moveTo(r,o+c/2),s.lineTo(r+l/2,o),s.lineTo(r+l,o+c/2),s.lineTo(r+l/2,o+c),s.closePath(),n.fill(),n.restore()}}},{key:"displaySnake",value:function(e){var t=this,a=this.ctx;a.save(),e.positions.forEach((function(i,n,s){var r=Object(p.a)(i,2),o=r[0],l=r[1];n===s.length-1?(a.beginPath(),a.ellipse(l*t.unitWidth+t.unitWidth/2,o*t.unitHeight+t.unitHeight/2,t.unitWidth/2,t.unitHeight/2,0,0,2*Math.PI),a.closePath()):(a.beginPath(),a.rect(l*t.unitWidth,o*t.unitHeight,t.unitWidth,t.unitHeight),a.closePath());var c=t.positionHasOverlap(t.game.board.get([o,l]))?.4:1;a.fillStyle=f(e.color,c),a.strokeStyle="#ffffff",a.lineWidth=2,a.fill(),a.stroke()})),a.restore()}},{key:"displayGrid",value:function(){var e=this.ctx;e.save(),e.beginPath();for(var t=0;t<=this.game.props.columns;t++){var a=Math.min(t*this.unitWidth+.5,this.props.width-.5);e.moveTo(a,0),e.lineTo(a,this.props.height)}for(var i=0;i<=this.game.props.rows;i++){var n=Math.min(i*this.unitHeight+.5,this.props.height-.5);e.moveTo(0,n),e.lineTo(this.props.width,n)}e.strokeStyle="rgba(180, 180, 180, 0.4)",e.stroke(),e.restore()}},{key:"displayWalls",value:function(){var e=this,t=this.ctx;t.save(),t.strokeStyle="#000000",t.fillStyle="#ff0000",t.lineWidth=2,this.props.game.board.walls.forEach((function(a){var i=Object(p.a)(a.position,2),n=i[0],s=i[1];t.beginPath(),t.rect(s*e.unitWidth,n*e.unitHeight,e.unitWidth,e.unitHeight),t.closePath(),t.fill(),t.stroke()})),t.restore()}},{key:"positionHasOverlap",value:function(e){if(e.snakes.size<2&&e.fruits.size<2)return!1;for(var t=0,a=0;a<this.game.visibleSnakes.length;a++){var i=this.game.visibleSnakes[a];if(e.snakes.has(i)&&t++,e.fruits.has(i)&&t++,t>1)return!0}return!1}},{key:"componentDidMount",value:function(){this.ctx=this.canvas.current.getContext("2d"),this.display()}},{key:"render",value:function(){return n.a.createElement("canvas",{className:"game",ref:this.canvas,width:this.props.width,height:this.props.height})}}]),a}(n.a.Component),g=a(112),k=a(610),b=a.n(k),y=a(612),w=a.n(y)()(b.a),S=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(c.a)(this,a),(i=t.call(this,e)).evolver=void 0,i.postGen=function(){var e=i.evolver.game.snakes.map((function(e){return e.fruits})),t=Math.max.apply(Math,Object(g.a)(e));i.setState({generations:[].concat(Object(g.a)(i.state.generations),[i.evolver.generation]),max:[].concat(Object(g.a)(i.state.max),[t])})},i.evolver=e.evolver,i.state={generations:[],max:[]},i}return Object(h.a)(a,[{key:"componentDidMount",value:function(){this.evolver.addCallback("postGen",this.postGen)}},{key:"componentWillUnmount",value:function(){this.evolver.removeCallback("postGen",this.postGen)}},{key:"render",value:function(){var e=[{type:"scatter",x:this.state.generations,y:this.state.max,line:{shape:"spline",smoothing:1.5}}];return n.a.createElement(w,{className:"evolution-plot",data:e,layout:{xaxis:{title:"Generation",fixedrange:!0,rangemode:"nonnegative"},yaxis:{title:"Score",fixedrange:!0,rangemode:"nonnegative"},margin:{l:40,r:20,b:40,t:20,pad:4}},config:{displayModeBar:!1}})}}]),a}(n.a.Component),O=a(620),j=a(1501),E=a(1493),x=a(157),T=a(621),W=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(c.a)(this,a),(i=t.call(this,e)).handleClose=function(){console.log("close"),i.props.game.continue(),i.setState({showModal:!1})},i.handleShow=function(){console.log("show"),i.props.game.pause(),i.setState({showModal:!0})},i.state={showModal:!1},i}return Object(h.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:"help"},n.a.createElement(j.a,{title:"What's this?",placement:"right",arrow:!0},n.a.createElement(E.a,{color:"primary","aria-label":"what's this",onClick:this.handleShow},n.a.createElement(O.a,{className:"help-icon"}))),n.a.createElement(x.a,{show:this.state.showModal,onHide:this.handleClose,dialogClassName:"help-modal"},n.a.createElement(x.a.Header,{closeButton:!0},n.a.createElement(x.a.Title,null,"What's this?")),n.a.createElement(x.a.Body,{className:"help-modal-body"},n.a.createElement("p",null,"This is a visualization of bots learning to play the classic game of"," ",n.a.createElement("span",{className:"bold"},"Snake")," via ",n.a.createElement("span",{className:"bold"},"Neuroevolution"),". You'll notice that there are multiple snakes on screen. That's due to the nature of the neuroevolution algorithm, inspired by Darwin's theory of evolution. Although snakes play the game independently from each other, they are part of a competing population, following the concept of"," ",n.a.createElement("span",{className:"bold"},"survival of the fittest"),". Each snake has its own way of playing the game, and the better they are at it, the more likely they and their offspring are to advance to the next ",n.a.createElement("span",{className:"bold"},"generation")," (i.e. the next game). Similarly, snakes that do not perform well are gradually eliminated from the population. As generations progress, the score of the population tends to improve, allowing us to discover (hopefully) good strategies for playing the game, even if not optimal."),n.a.createElement("p",null,"Game instructions:",n.a.createElement("ul",null,n.a.createElement("li",null,"The goal is to get as many diamonds as possible, each awarding 1 point."),n.a.createElement("li",null,"Snakes do not collide with each other and can only collect their own diamonds."),n.a.createElement("li",null,n.a.createElement("span",{className:"red"},"Red blocks")," are obstacles. They can be toggled on or off at any time with the switch on the right-hand side."))),n.a.createElement("p",null,"This project uses ",n.a.createElement("a",{href:"https://github.com/wagenaartje/neataptic"},"Neataptic"),"'s implementation of the"," ",n.a.createElement("a",{href:"http://nn.cs.utexas.edu/downloads/papers/stanley.ec02.pdf"},"NEAT")," ","algorithm."),n.a.createElement("p",null,"For more details, check ",n.a.createElement("a",{href:"https://github.com/PPinto22/snake-evolver"},"GitHub"),"."," ",n.a.createElement("span",{role:"img","aria-label":"snake emoji"},"\ud83d\udc0d"))),n.a.createElement(x.a.Footer,null,n.a.createElement(T.a,{variant:"primary",onClick:this.handleClose},"OK"))))}}]),a}(n.a.Component),M=a(92),F=a.n(M),H=a(196),P=a(244),N=function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(c.a)(this,e),this.position=void 0,this.isWall=void 0,this.snakes=void 0,this.fruits=void 0,this.position=t,this.isWall=a,this.snakes=new Set,this.fruits=new Set}return Object(h.a)(e,[{key:"hasObstacle",value:function(e){return this.isWall||this.snakes.has(e)}},{key:"isEmpty",value:function(){return!this.isWall&&0===this.snakes.size&&0===this.fruits.size}},{key:"clearObjects",value:function(){this.snakes.clear(),this.fruits.clear(),this.isWall=!1}}]),e}(),C=a(618),G=a.n(C);function z(e){return new Promise((function(t){return setTimeout(t,e)}))}function B(e){var t=(new Date).getTime();return[e(),(new Date).getTime()-t]}var V=function(){function e(t,a){var i=this;Object(c.a)(this,e),this.grid=void 0,this.rows=void 0,this.columns=void 0,this.walls=void 0,this.freeSpaces=void 0,this.rows=t,this.columns=a,this.grid=Array.from({length:t},(function(e,t){return Array.from({length:a},(function(e,a){return new N([t,a])}))})),this.walls=new Set,this.freeSpaces=new Set,this.grid.map((function(e){return e.map((function(e){return!e.isWall&&i.freeSpaces.add(e)}))}))}return Object(h.a)(e,[{key:"clearObjects",value:function(){this.removeWalls(),this.grid.forEach((function(e){return e.forEach((function(e){e.clearObjects()}))}))}},{key:"removeWalls",value:function(){var e=this;this.walls.forEach((function(t){e.removeWall(t.position)}))}},{key:"get",value:function(e){var t;if(e){var a=Object(p.a)(e,2),i=a[0],n=a[1];return null===(t=this.grid[i])||void 0===t?void 0:t[n]}}},{key:"getAdjacent",value:function(e){for(var t=Object(p.a)(e,2),a=t[0],i=t[1],n=[0,1,0,-1,0],s=[],r=0;r<4;r++){var o=a+n[r],l=i+n[r+1];this.outOfBounds([o,l])||s.push(this.grid[o][l])}return s}},{key:"addSnake",value:function(e){var t=this;e.positions.forEach((function(a){var i=Object(p.a)(a,2),n=i[0],s=i[1];t.grid[n][s].snakes.add(e)})),e.fruit&&this.addFruit(e,e.fruit)}},{key:"deleteSnake",value:function(e){var t=this;e.positions.forEach((function(a){var i=Object(p.a)(a,2),n=i[0],s=i[1];t.grid[n][s].snakes.delete(e)})),e.fruit&&this.deleteFruit(e,e.fruit)}},{key:"addSnakePosition",value:function(e,t){var a=Object(p.a)(t,2),i=a[0],n=a[1];this.grid[i][n].snakes.add(e)}},{key:"removeSnakePosition",value:function(e,t){var a=Object(p.a)(t,2),i=a[0],n=a[1];this.grid[i][n].snakes.delete(e)}},{key:"addFruit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getRandomFreeSpace(e);if(t){var a=Object(p.a)(t,2),i=a[0],n=a[1];return this.grid[i][n].fruits.add(e),t}}},{key:"deleteFruit",value:function(e,t){var a=Object(p.a)(t,2),i=a[0],n=a[1];this.grid[i][n].fruits.delete(e)}},{key:"getRandomFreeSpace",value:function(e){var t=this,a=new Set(this.freeSpaces);return e&&e.positions.forEach((function(e){var i=Object(p.a)(e,2),n=i[0],s=i[1],r=t.grid[n][s];a.delete(r)})),function(e){if(0!==e.length)return e[Math.floor(Math.random()*e.length)]}(Array.from(a).map((function(e){return e.position})))}},{key:"addWall",value:function(e){var t=Object(p.a)(e,2),a=t[0],i=t[1],n=this.grid[a][i];n.isWall=!0,this.walls.add(n),this.freeSpaces.delete(n)}},{key:"removeWall",value:function(e){var t=Object(p.a)(e,2),a=t[0],i=t[1],n=this.grid[a][i];n.isWall=!1,this.walls.delete(n),this.freeSpaces.add(n)}},{key:"toggleWall",value:function(e){var t=this.grid[e[0]][e[1]];return t.isWall?this.removeWall(e):this.addWall(e),t.isWall}},{key:"outOfBounds",value:function(e){var t=Object(p.a)(e,2),a=t[0],i=t[1];return a<0||i<0||a>=this.rows||i>=this.columns}}],[{key:"getVector",value:function(e){switch(e){case"up":return[-1,0];case"down":return[1,0];case"right":return[0,1];case"left":return[0,-1]}}}]),e}();function D(e){var t=Object(p.a)(e,2),a=t[0],i=t[1];return"(".concat(a,", ").concat(i,")")}function I(e,t){var a=Object(p.a)(e,2),i=a[0],n=a[1],s=Object(p.a)(t,2),r=s[0],o=s[1];return Math.abs(i-r)+Math.abs(n-o)}function A(e,t){return t.map((function(t,a){return t-e[a]}))}function R(e){var t=Object(p.a)(e,2),a=t[0],i=t[1];return Math.atan2(i,a)}var L=["up","right","down","left"],K=function(e){return L[(L.findIndex((function(t){return t===e}))+3)%4]},J=function(e){return L[(L.findIndex((function(t){return t===e}))+1)%4]},U=function(){function e(t,a,i,n){Object(c.a)(this,e),this.id=void 0,this.color=void 0,this.positions=void 0,this.direction=void 0,this.fruit=void 0,this.score=void 0,this.fruits=void 0,this.alive=void 0,this.history=void 0,this.brain=void 0,this.id=t,this.color=function(e){var t=G()(null===e||void 0===e?void 0:e.toString()),a=String("#"+t().toString(16).slice(2,8).toUpperCase()).replace(/[^0-9a-f]/gi,"");a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);var i,n,s="#";for(n=0;n<3;n++)i=parseInt(a.substr(2*n,2),16),s+=("00"+(i=Math.round(Math.min(Math.max(0,i+-.2*i),255)).toString(16))).substr(i.length);return s}("seed ".concat(this.id)),this.positions=a,this.direction=i,this.fruit=n,this.fruits=0,this.score=0,this.history=new Map,this.alive=!0}return Object(h.a)(e,[{key:"setBrain",value:function(e,t,a){this.brain=new a(this,e,t)}},{key:"think",value:function(){var e,t=null===(e=this.brain)||void 0===e?void 0:e.activate();switch(t){case"left":this.direction=K(this.direction);break;case"right":this.direction=J(this.direction)}return t||"forward"}},{key:"getHead",value:function(){if(0===this.positions.length)throw new Error("Empty snake");return this.positions[this.positions.length-1]}},{key:"getNextPosition",value:function(){var e=this.getHead(),t=Object(p.a)(e,2),a=t[0],i=t[1],n=V.getVector(this.direction),s=Object(p.a)(n,2);return[a+s[0],i+s[1]]}},{key:"moveTo",value:function(e){return this.extendTo(e),this.positions.shift()}},{key:"extendTo",value:function(e){var t=Object(p.a)(e,2),a=t[0],i=t[1],n=this.getHead(),s=Object(p.a)(n,2),r=s[0],o=s[1];if(Math.abs(r-a)+Math.abs(o-i)>1)throw new Error("Cannot move further than one unit");this.positions.push([a,i]),this.addHistory([a,i])}},{key:"addHistory",value:function(e){var t=D(e),a=this.history.get(t)||0;this.history.set(t,a+1)}},{key:"getHistoryCount",value:function(e){return this.history.get(D(e))||0}},{key:"eatFruit",value:function(e){this.fruit=e,this.fruits+=1,this.history.clear()}}]),e}(),Y=function(){function e(){Object(c.a)(this,e)}return Object(h.a)(e,[{key:"getMoveScore",value:function(e,t,a){return a.fruit?1:0}}]),e}(),$=Y,q=function(){function e(t,a,i){Object(c.a)(this,e),this.snake=void 0,this.board=void 0,this.network=void 0;var n=this.constructor;if(a.input!==n.inputSize||a.output!==n.outputSize)throw Error("The number of inputs or outputs defined in Brain do not match the neural network's.");this.snake=t,this.network=a,this.board=i}return Object(h.a)(e,[{key:"activate",value:function(){this.network.clear();var e=this.getInputs(),t=function(e){if(0!==e.length){for(var t=e[0],a=0,i=1;i<e.length;i++)e[i]>t&&(a=i,t=e[i]);return[a,t]}}(this.network.activate(e));switch(Object(p.a)(t,1)[0]){case 1:return"left";case 2:return"right";case 0:default:return"forward"}}},{key:"relativeFruitPosition",value:function(){if(this.snake.fruit)return function(e,t){var a=Object(p.a)(e,2),i=a[0],n=a[1];return[i*Math.cos(t)+n*Math.sin(t),-i*Math.sin(t)+n*Math.cos(t)]}(A(this.snake.getHead(),this.snake.fruit),R(V.getVector(this.snake.direction)))}},{key:"distanceToObstacle",value:function(e){var t=Object(p.a)(e,2),a=t[0],i=t[1],n=this.snake.getHead(),s=Object(p.a)(n,2),r=s[0],o=s[1],l=0;do{var c=r+ ++l*a,h=o+l*i}while(!this.board.outOfBounds([c,h])&&!this.board.get([c,h]).hasObstacle(this.snake));return I([r,o],[c,h])}},{key:"distanceToFruit",value:function(){return this.snake.fruit?I(this.snake.getHead(),this.snake.fruit):NaN}},{key:"fruitAngle",value:function(){return this.snake.fruit?R(this.relativeFruitPosition())/Math.PI:NaN}}]),e}();q.inputSize=NaN,q.outputSize=3,(function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(h.a)(a,[{key:"getInputs",value:function(){return[this.distanceToObstacle(V.getVector(this.snake.direction)),this.distanceToObstacle(V.getVector(K(this.snake.direction))),this.distanceToObstacle(V.getVector(J(this.snake.direction))),this.distanceToFruit(),this.fruitAngle()]}}]),a}(q)).inputSize=5;var Q=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(c.a)(this,a);for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).maxDistance=void 0,e.maxDistance=Math.max(e.board.columns,e.board.rows),e}return Object(h.a)(a,[{key:"getInputs",value:function(){var e=this.relativeFruitPosition()||[NaN,NaN];return[this.inverseDistanceToObstacle(V.getVector(this.snake.direction)),this.inverseDistanceToObstacle(V.getVector(K(this.snake.direction))),this.inverseDistanceToObstacle(V.getVector(J(this.snake.direction))),this.signedProximity(e[0]),this.signedProximity(e[1])]}},{key:"inverseDistanceToObstacle",value:function(e){var t=this.distanceToObstacle(e);return 1/Math.pow(t,2)}},{key:"signedProximity",value:function(e){var t=e/this.maxDistance;return t>=0?1-t:-1-t}}]),a}(q);Q.inputSize=5;var X=Q,Z=function(){function e(t){var a=this;Object(c.a)(this,e),this.props=void 0,this.callbacks=void 0,this.board=void 0,this.snakes=void 0,this.aliveSnakes=void 0,this.visibleSnakes=void 0,this.state=void 0,this.iteration=void 0,this.sleepTime=void 0,this.moveSnake=function(e){if(e.alive){var t=a.getMove(e);if(e.score+=a.props.scoreService.getMoveScore(a.board,e,t),t.died)a.killSnake(e);else if(t.fruit){e.extendTo(t.to);var i=a.board.addFruit(e);e.eatFruit(i),a.board.addSnakePosition(e,t.to),a.board.deleteFruit(e,t.to)}else{var n=e.moveTo(t.to);a.board.addSnakePosition(e,t.to),a.board.removeSnakePosition(e,n)}}},this.props=Object(P.a)({},e.defaultProps,{},t),this.callbacks={onMove:[],onEnd:[]},this.board=new V(this.props.rows,this.props.columns),this.addRandomWalls(),this.initSnakes(),this.iteration=0,this.state="stopped",this.setSpeed(this.props.speed,!1),this.sleepTime=this.props.speed?1e3/this.props.speed:0}return Object(h.a)(e,[{key:"pause",value:function(){this.state="stopped"}},{key:"continue",value:function(){this.state="running"}},{key:"addRandomWalls",value:function(){for(var e=0;e<this.props.rows;e++)if(1!==e&&e!==this.props.rows-this.props.spawnMargin-1)for(var t=0;t<this.props.columns;t++)1!==t&&t!==this.props.columns-this.props.spawnMargin-1&&this.board.get([e,t]).isEmpty()&&Math.random()<this.props.wallDensity&&this.board.addWall([e,t])}},{key:"removeWalls",value:function(){this.board.removeWalls()}},{key:"setVisibleSnakes",value:function(e){this.props.visibleSnakes=e,this.updateVisibleSnakes()}},{key:"updateVisibleSnakes",value:function(){this.visibleSnakes=this.snakes.slice(0,this.props.visibleSnakes).filter((function(e){return e.alive}))}},{key:"setSpeed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.props.speed=e,this.sleepTime=1e3/e,t&&(this.state=e>0?"running":"stopped")}},{key:"addCallback",value:function(e,t){var a;return null===(a=this.callbacks[e])||void 0===a||a.push(t),this}},{key:"initSnakes",value:function(){var e=this;this.snakes=Array.from({length:this.props.snakes},(function(t,a){return e.createSnake(a,a)})),this.snakes.forEach((function(t){return e.board.addSnake(t)})),this.snakes.forEach((function(t){return t.fruit=e.board.addFruit(t)})),this.props.neuralNetworks&&this.setBrains(this.props.neuralNetworks),this.updateVisibleSnakes(),this.aliveSnakes=Object(g.a)(this.snakes)}},{key:"setBrains",value:function(e){if(e.length!==this.props.snakes)throw new Error("The number of brains does not match the number of snakes");this.props.neuralNetworks=e;for(var t=0;t<this.props.snakes;t++)e[t]&&this.snakes[t].setBrain(e[t],this.board,this.props.brainType)}},{key:"run",value:function(){var e=Object(H.a)(F.a.mark((function e(){var t,a,i,n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.move.bind(this),this.state="running";case 2:if("ended"===this.state){e.next=14;break}case 3:if("stopped"!==this.state){e.next=8;break}return e.next=6,z(400);case 6:e.next=3;break;case 8:if(a=B(t),i=Object(p.a)(a,2),n=i[1],!(this.visibleSnakes.length&&0!==this.sleepTime||this.iteration%50===0)){e.next=12;break}return e.next=12,z(Math.max(this.sleepTime-n,0));case 12:e.next=2;break;case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reset",value:function(){this.state="stopped",this.iteration=0;var e=this.board.walls.size>0;this.board.clearObjects(),e&&this.addRandomWalls(),this.initSnakes()}},{key:"move",value:function(){"running"===this.state&&(this.iteration++,this.aliveSnakes.forEach(this.moveSnake),this.callbacks.onMove.forEach((function(e){return e()})),this.aliveSnakes.length||(this.state="ended",this.callbacks.onEnd.forEach((function(e){return e()}))))}},{key:"createSnake",value:function(e,t){for(var a=this,i=this.props.columns-2*this.props.spawnMargin,n=this.props.rows-2*this.props.spawnMargin,s=2*i+2*n-4,r=[0,i-1,i+n-2,i+n+i-3,s],o=function(e){var t,o;switch(e%=s,r.findIndex((function(t,a){var i=r[a+1];return i&&t<=e&&e<i}))){case 0:t=[0,e],o="right";break;case 1:t=[e-i+1,i-1],o="down";break;case 2:t=[n-1,s-n-e+1],o="left";break;case 3:t=[s-e,0],o="up";break;default:throw new Error("Invalid distance.")}return[[t[0]+a.props.spawnMargin,t[1]+a.props.spawnMargin],o]},l=Math.floor(e*s/this.props.visibleSnakes),c="right",h=[],u=0;u<this.props.snakeLength;u++){var d=o(l+u),v=Object(p.a)(d,2),f=v[0],m=v[1];h.push(f),c=m}return new U(t,h,c)}},{key:"shouldKillSnake",value:function(e,t){return this.board.outOfBounds(t)||this.board.get(t).hasObstacle(e)||e.getHistoryCount(t)>2}},{key:"getMove",value:function(e){var t,a=e.getHead(),i=e.think(),n=e.getNextPosition();return{from:a,to:n,turn:i,fruit:!!(null===(t=this.board.get(n))||void 0===t?void 0:t.fruits.has(e)),died:this.shouldKillSnake(e,n)}}},{key:"killSnake",value:function(e){var t,a=this;e.alive=!1,e.positions.forEach((function(t){var i;null===(i=a.board.get(t))||void 0===i||i.snakes.delete(e)})),null===(t=this.board.get(e.fruit))||void 0===t||t.fruits.delete(e),this.aliveSnakes=this.aliveSnakes.filter((function(t){return t!==e})),this.updateVisibleSnakes()}}]),e}();Z.defaultProps={rows:25,columns:50,snakes:20,visibleSnakes:20,snakeLength:4,spawnMargin:1,wallDensity:.07,speed:10,scoreService:new $,brainType:X};var _=a(357),ee=function(){function e(t,a){if(Object(c.a)(this,e),this.game=void 0,this.params=void 0,this.brainType=void 0,this.neat=void 0,this.generation=void 0,this.state=void 0,this.callbacks=void 0,t.props.snakes<2)throw new Error("Popsize must be at least 2");this.game=t,this.brainType=this.game.props.brainType,this.callbacks={preGen:[],postGen:[]},this.params=Object(P.a)({},this.defaultParams(),{},a),this.neat=new _.Neat(this.brainType.inputSize,this.brainType.outputSize,this.evaluatePopulation.bind(this),this.params),this.generation=0,this.state="stopped"}return Object(h.a)(e,[{key:"defaultParams",value:function(){return{popsize:this.game.props.snakes,elitism:Math.round(.2*this.game.props.snakes),mutationRate:.3,mutationAmount:1,fitnessPopulation:!0}}},{key:"createNetwork",value:function(){return new _.architect.Perceptron(this.brainType.inputSize,5,this.brainType.outputSize)}},{key:"addCallback",value:function(e,t){return this.callbacks[e].push(t),this}},{key:"removeCallback",value:function(e,t){return this.callbacks[e]=this.callbacks[e].filter((function(e){return e!==t})),this}},{key:"setBrains",value:function(){this.game.setBrains(this.neat.population)}},{key:"sortPopulation",value:function(){for(var e=[],t=this.params.popsize-this.params.elitism;t<this.params.popsize;t++)e.push(this.neat.population[t]);for(var a=0;a<this.params.popsize-this.params.elitism;a++)e.push(this.neat.population[a]);this.neat.population=e}},{key:"evaluatePopulation",value:function(){var e=Object(H.a)(F.a.mark((function e(t){var a;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.game.setBrains(this.neat.population),e.next=3,this.game.run();case 3:for(a=0;a<this.params.popsize;a++)t[a].score=this.game.snakes[a].score;case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"run",value:function(){var e=Object(H.a)(F.a.mark((function e(){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.state="running";case 1:if("running"!==this.state){e.next=11;break}return this.generation+=1,this.callbacks.preGen.forEach((function(e){return e()})),e.next=6,this.neat.evolve();case 6:this.sortPopulation(),this.callbacks.postGen.forEach((function(e){return e()})),this.game.reset(),e.next=1;break;case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),te=a(1494),ae=a(1495),ie=a(1454),ne=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(h.a)(a,[{key:"render",value:function(){return n.a.createElement(te.a,{className:"stat-card"},n.a.createElement(ae.a,null,n.a.createElement(ie.a,{className:"stat-card-title",color:"textSecondary",variant:"button",gutterBottom:!0},this.props.title),n.a.createElement(ie.a,{variant:"h5"},this.props.content)))}}]),a}(n.a.Component),se=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(c.a)(this,a),(i=t.call(this,e)).evolver=void 0,i.game=void 0,i.preGenHandler=function(){i.setState({generation:i.evolver.generation})},i.postGenHandler=function(){var e=Math.max.apply(Math,Object(g.a)(i.game.snakes.map((function(e){return e.fruits}))));e>i.state.highScore&&i.setState({highScore:e})},i.state={generation:0,highScore:0},i.evolver=i.props.evolver,i.game=i.evolver.game,i.evolver.addCallback("preGen",i.preGenHandler),i.evolver.addCallback("postGen",i.postGenHandler),i}return Object(h.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:"stat-cards"},n.a.createElement(ne,{title:"High Score",content:this.state.highScore}),n.a.createElement(ne,{title:"Generation",content:this.state.generation}))}}]),a}(n.a.Component),re=a(1503),oe=a(1500),le=a(1498),ce=a(1499),he=a(1496),ue=a(1497),de=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(c.a)(this,a),(i=t.call(this,e)).speed=void 0,i.toggleFastForward=function(e){var t,a,n=e.target.checked;null===(t=(a=i.props).onFastForwardToggle)||void 0===t||t.call(a,n,i.speed),i.setState({fastForward:n})},i.sliderHandler=function(e,t){var a,n,s=t;i.speed=s,null===(a=(n=i.props).onSpeedChange)||void 0===a||a.call(n,s)},i.handleSnakeSelect=function(e){var t,a;null===(t=(a=i.props).onSnakeSelect)||void 0===t||t.call(a,e.target.value)},i.toggleWalls=function(e){var t,a,n=e.target.checked;null===(t=(a=i.props).onWallsToggle)||void 0===t||t.call(a,n)},i.state={fastForward:!1},i.speed=a.defaults.speed,i}return Object(h.a)(a,[{key:"render",value:function(){var e=n.a.createElement(re.a,{className:"speed-slider",valueLabelFormat:function(e){return"".concat(e,"x")},valueLabelDisplay:"auto",defaultValue:a.defaults.speed,min:0,max:100,onChange:this.sliderHandler,disabled:this.state.fastForward}),t=n.a.createElement(oe.a,{className:"ff-switch",checked:this.state.fastForward,onChange:this.toggleFastForward}),i=n.a.createElement(le.a,{className:"snake-select",onChange:this.handleSnakeSelect,defaultValue:a.defaults.snakes,disabled:this.state.fastForward},n.a.createElement(ce.a,{value:1},"Top 1"),n.a.createElement(ce.a,{value:3},"Top 3"),n.a.createElement(ce.a,{value:5},"Top 5"),n.a.createElement(ce.a,{value:10},"Top 10"),n.a.createElement(ce.a,{value:20},"Top 20")),s=n.a.createElement(oe.a,{className:"wall-switch",defaultChecked:!0,onChange:this.toggleWalls});return n.a.createElement(he.a,{row:!0,className:"controls"},n.a.createElement("div",{className:"left"},n.a.createElement(ue.a,{label:"Fast Forward",control:t,labelPlacement:"start"}),n.a.createElement(ue.a,{label:"Speed",control:e,labelPlacement:"start"}),n.a.createElement(ue.a,{label:"Show",control:i,labelPlacement:"start"})),n.a.createElement("div",{className:"right"},n.a.createElement(ue.a,{label:"Obstacles",control:s,labelPlacement:"end"})))}}]),a}(i.Component);de.defaults={speed:10,snakes:10};a(1447);var pe=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(c.a)(this,a),(i=t.call(this,e)).game=void 0,i.evolver=void 0,i.speedChangeHandler=function(e){i.game.setSpeed(e)},i.fastForwardHandler=function(e,t){var a=e?1/0:t;i.game.setSpeed(a)},i.snakeSelectHandler=function(e){i.game.setVisibleSnakes(e),i.setState({snakes:e})},i.wallsHandler=function(e){e?i.game.addRandomWalls():i.game.removeWalls()},i.state={snakes:de.defaults.snakes},i.game=new Z({rows:20,columns:40,snakes:100,visibleSnakes:de.defaults.snakes,speed:de.defaults.speed,snakeLength:4,scoreService:new Y,brainType:Q}),i.evolver=new ee(i.game),i}return Object(h.a)(a,[{key:"componentDidMount",value:function(){this.evolver.run()}},{key:"render",value:function(){return n.a.createElement("div",{id:"app"},n.a.createElement(W,{game:this.game}),n.a.createElement("div",{id:"stats"},n.a.createElement(se,{evolver:this.evolver}),n.a.createElement(S,{evolver:this.evolver})),n.a.createElement("div",{id:"game-container"},n.a.createElement(de,{onSpeedChange:this.speedChangeHandler,onFastForwardToggle:this.fastForwardHandler,onSnakeSelect:this.snakeSelectHandler,onWallsToggle:this.wallsHandler}),n.a.createElement(m,{width:1e3,height:500,game:this.game,snakes:this.state.snakes})))}}]),a}(n.a.Component);r.a.render(n.a.createElement(o.a,{basename:"/snake-evolver/"},n.a.createElement(l.c,null,n.a.createElement(l.a,{path:"/",exact:!0,component:pe}),n.a.createElement(l.a,{component:function(){return n.a.createElement("div",{id:"not-found"},n.a.createElement("h1",null,"Page not found"))}}))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},631:function(e,t,a){e.exports=a(1451)},636:function(e,t,a){},640:function(e,t){},913:function(e,t){}},[[631,1,2]]]);
//# sourceMappingURL=main.746ff5b8.chunk.js.map